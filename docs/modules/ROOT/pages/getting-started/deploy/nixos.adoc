= Deploy with NixOS

NixOS deployment can be performed on the target machine itself or remotely
by means of `nixos-rebuild --target-host`.

These instructions will use `/etc/nixos` as the location for the configuration
modules. This directory is only used at evaluation time. If you perform remote
deployment, you will use some project directory in place of `/etc/nixos`.

== 1. Bootstrap

include::partial$snippets/CachixBinaries.adoc[]

include::partial$snippets/NixOSBootstrap.adoc[]

== 2. Get a cluster join token.

include::partial$snippets/GenerateToken.adoc[]

== 3. Configure a binary cache

include::partial$snippets/NixOSBinaryCaches.adoc[]

== 4. Activation

include::partial$snippets/NixOSActivate.adoc[]

== 5. Repository Setup

include::partial$snippets/RepositorySetup.adoc[]

== Troubleshooting

To inspect the agent's local log, run `journalctl -u hercules-ci-agent -n 100` on the target machine to see the last 100 lines.
